# Tasks for Publishing to NPM and Construct Hub

## Overview
This document outlines the steps needed to prepare the CDK Serverless Agentic API construct for publication to NPM and inclusion in the AWS Construct Hub.

## Prerequisites
- Node.js 22.0.0 or higher (current environment requires nvm to switch to this version)
  - Install nvm if not already installed: `curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash`
  - Install Node.js 22: `nvm install 22`
- npm account (create one at https://www.npmjs.com/signup if needed)
- AWS CDK v2.170.0 or higher

## Tasks

### 1. Update package.json
- [x] Ensure package.json has all required fields:
  - name: "cdk-serverless-agentic-api"
  - version: (use semantic versioning)
  - description
  - keywords (include "cdk", "aws-cdk", "constructs", "serverless")
  - homepage: https://github.com/rhyslewisakl/cdk-serverless-agentic-api/
  - repository https://github.com/rhyslewisakl/cdk-serverless-agentic-api/issues
  - license: MIT
  - author: Rhys Lewis, rhys@rhyslewis.nz
  - main, types, and jsii fields

### 2. Add Required Files for Construct Hub
- [x] Create a .jsii file (will be generated by jsii)
- [x] Create a LICENSE file (MIT license recommended)
- [x] Create an index.ts file in src/ that exports all public components
- [x] Ensure README.md is comprehensive with usage examples
- [x] Add NOTICE file if using third-party libraries

### 3. Configure JSII
- [x] Install jsii: `npm install --save-dev jsii jsii-pacmak`
- [x] Add jsii configuration to package.json:
```json
"jsii": {
  "outdir": "dist",
  "targets": {
    "python": {
      "distName": "cdk-serverless-agentic-api",
      "module": "cdk_serverless_agentic_api"
    },
    "java": {
      "package": "nz.rhyslewis.cdkserverlessagenticapi",
      "maven": {
        "groupId": "nz.rhyslewis",
        "artifactId": "cdk-serverless-agentic-api"
      }
    },
    "dotnet": {
      "namespace": "NZRhysLewis.CdkServerlessAgenticApi",
      "packageId": "NZRhysLewis.CdkServerlessAgenticApi"
    }
  }
}
```

### 4. Add Construct Hub Metadata
- [x] Add AWS CDK metadata to package.json:
```json
"awscdkio": {
  "twitter": "rhyslewisakl",
  "announce": true
},
"keywords": [
  "aws",
  "cdk",
  "constructs",
  "serverless",
  "api",
  "cloudfront",
  "cognito",
  "apigateway"
]
```

### 5. Update Dependencies
- [x] Ensure all AWS CDK dependencies use the same version
- [x] Mark AWS CDK packages as peer dependencies
- [x] Add "constructs" as a peer dependency

### 6. Prepare for Publication
- [x] Run tests: `npm test`
- [ ] Switch to Node.js 22: `nvm use 22`
- [x] Fix TypeScript errors and warnings:
  - [x] Remove unused imports
  - [x] Fix unused variables (add `// eslint-disable-next-line @typescript-eslint/no-unused-vars` where needed)
  - [x] Fix type errors in tests
  - [x] Update examples to use `CDKServerlessAgenticAPI` instead of `ServerlessWebAppConstruct`
- [x] Build the package: `npm run build`
- [x] Generate JSII artifacts: `npm run package`
- [x] Create a .npmignore file to exclude unnecessary files

### 7. Publish to NPM
- [ ] Login to npm: `npm login`
- [ ] Publish package: `npm publish --access public`

### 8. Verify Construct Hub Inclusion
- [ ] Wait for Construct Hub to index the package (usually within 24 hours)
- [ ] Check https://constructs.dev/search?q=cdk-serverless-agentic-api

### 9. Create GitHub Release
- [ ] Tag the release in git: `git tag v1.0.0`
- [ ] Push the tag: `git push origin v1.0.0`
- [ ] Create a GitHub release with release notes


## References
- [Construct Hub Contribution Guide](https://constructs.dev/contribute)
- [JSII Documentation](https://aws.github.io/jsii/)
- [NPM Publishing Guide](https://docs.npmjs.com/packages-and-modules/contributing-packages-to-the-registry)
- [AWS CDK API Reference](https://docs.aws.amazon.com/cdk/api/latest/)